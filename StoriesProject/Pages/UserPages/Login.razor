@page "/login"
@using StoriesProject.Model.ViewModel.Accountant;
@using StoriesProject.Services;
@inject IAccoutantsService _accoutantsService;
@inject IJSRuntime _js;
@inject NavigationManager _navigationManager;
<html class="mdl-js">

<head>
    <title>登录 - 漫客栈</title>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="keywords"
          content="漫画大全,漫画图片,漫画投稿,在线漫画,斗破苍穹漫画,斗罗大陆漫画,偷星九月天,穿越西元3000后,凤逆天下,风起苍岚,妃夕妍雪,BL漫画,耽美漫画,知音漫客,飒漫画,漫画下载">
    <meta name="description" content="中国领先的原创漫画平台，七年来积累了大量的签约作者和好看的漫画作品，斗破苍穹漫画、斗罗大陆漫画，更有APP和漫画下载等精彩内容等你发现，看漫画，就来漫客栈！">
    <link rel="shortcut icon" href="https://static.mkzcdn.com/common/favicon.ico" type="image/x-icon" />
    <link rel="Bookmark" href="https://static.mkzcdn.com/common/favicon.ico" />

    <link rel="stylesheet" href="//static.mkzcdn.com/home/assets/script/libs/layui/css/layui.css?v=0b3cd68">
    <link rel="stylesheet" href="//static.mkzcdn.com/home/assets/style/common/common_home.css?v=a75a636">


    <link rel="stylesheet" href="//static.mkzcdn.com/home/assets/style/bundle/home.css?v=c05d384">
    <link rel="stylesheet" href="//static.mkzcdn.com/home/assets/style/module/home/login/main.css?v=a93aa2b">

    <!-- start Dplus -->
    <!-- end Dplus -->
    <!--[if lt IE 9]>
    <script src="//static.mkzcdn.com/home/assets/script/libs/respond/respond.js?v=afc1984"></script>
    <![endif]-->
    <style>
        .dialog-login_form .input-block input {
            height: 40px;
        }

        .dialog-login_form .input-block--inline input {
            height: 40px;
            width: 182px;
        }

        .dialog-login_form .submit-btn {
            font-size: 16px;
            width: 283px;
        }

        .input-block--inline {
            width: 283px;
        }

        .in-header__nav .nav-item {
            width: auto;
            font-size: 16px;
        }

        .in-header__nav .underline {
            display: none;
            position: absolute;
            left: 7px;
            bottom: -3px;
            width: 50px;
            height: 3px;
            background: #ff620e;
            border-radius: 9px;
        }

        .page-login .footer-wrapper {
            height: inherit;
        }

        .page-login.fixed-footer .footer-wrapper {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 3;
        }
    </style>
</head>

<body class="page-login fixed-footer" data-feed="">
    <div style='display:none;'>
        <img src='https://static.mkzcdn.com/home/assets/images/common/app_logo.png' />
    </div>

    <!-- main-content -->
    <div class="main-content">
        <div class="container--response">
            <div class="login-box">
                <div class="login-pic">
                    <img src="//static.mkzcdn.com/home/assets/images/login/pic_loginpage_img.png?v=d5ddbcc" />
                </div>
                <!-- 登录弹框 -->
                <div class="dialog-login">
                    <!-- close -->
                    <div class="j-dialog-login-header dialog-login__header hide">
                        <i class="j-dialog-login-close dialog-login__header--close"></i>
                    </div>
                    <!-- 接口错误信息 -->
                    <div class="j-dialog-login-toast dialog-login__toast hide"></div>
                    <div class="dialog-login_content clearfix">
                        <!-- 登录/注册 -->
                        <div class="tab-content">
                            <!-- 登录 -->
                            <div class="j-tab-item tab-item @(isLogin ? "active" : "")" data-contentid="login">
                                <div class="dialog-login_form">
                                    <div class="form-title">
                                        <h3>Đăng nhập</h3>
                                        <span>Chưa có (&gt;^ω^&lt;)？ </span>
                                        <a class="j-dialog-login-mode" @onclick="ToggleIsLogin" data-contentid="register">
                                            Đăng kí
                                        </a>
                                    </div>
                                    <div class="form-item">
                                        <div class="input-block">
                                            <input type="text" name="account" autocomplete="off" placeholder="Username" @bind="loginViewModel.UserName" />
                                        </div>
                                    </div>
                                    <div class="form-item">
                                        <div class="input-block">
                                            <input type="password" name="password" placeholder="Password" autocomplete="off" @bind="loginViewModel.Password" />
                                        </div>
                                    </div>
                                    <div class="form-item" >
                                        <div class="j-login-submit submit-btn disabled-select" @onclick="(() => LoginAction(loginViewModel))">
                                            <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="@(isLogging ? "":"display:none")"></i>
                                            <span>Đăng nhập</span>
                                        </div>
                                    </div>
                                    <div class="form-item clearfix">
                                        <div class="j-remember-link remember-link disabled-select">
                                            <i class="iconfont icon-ic_read_choose_on1 checkbox"></i>Ghi nhớ
                                        </div>
                                        <div class="forgot-link disabled-select">
                                            <a href="/forgot" target="_blank">Quên mật khẩu?</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 注册 -->
                            <div class="j-tab-item tab-item @(!isLogin ? "active" : "")" data-contentid="register">
                                <div class="dialog-login_form">
                                    <div class="form-title">
                                        <h3>Đăng kí</h3>
                                        <a class="j-dialog-login-mode" @onclick="ToggleIsLogin" data-contentid="login">Đăng nhập>></a>
                                    </div>
                                    <div class="form-item">
                                        <div class="input-block">
                                            <input type="text" name="phone" placeholder="Số điện thoại" maxlength="10" autocomplete="off" />
                                        </div>
                                    </div>
                                    <div class="form-item">
                                        <div class="input-block--inline">
                                            <input type="text" name="verifycode" placeholder="Mã xác nhận" autocomplete="off" />
                                            <div class="j-sms-btn sms-btn" data-status="false">
                                                Gửi mã
                                            </div>
                                            <!-- <div class="j-sms-btn sms-btn disabled" data-status="false">
                                              短信验证
                                            </div> -->
                                        </div>
                                    </div>
                                    <div class="form-item">
                                        <div class="input-block">
                                            <input type="password" name="setpassword" placeholder="Mật khẩu (6-16 kí tự)"
                                                   autocomplete="off" />
                                        </div>
                                    </div>
                                    <div class="form-item">
                                        <div class="j-register-submit submit-btn disabled-select">
                                            <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"
                                               style="display: none"></i>Đăng ký
                                        </div>
                                    </div>
                                    <div class="tip-protocol">
                                        Việc đăng kí là đồng ý với<a class="j-dialog-login-protocol" data-protocolid="user">
                                            《các điều
                                            khoản》
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <!-- 二维码 -->
                            <div class="j-tab-item tab-item" data-contentid="qr">
                                <div class="dialog-login_form">
                                    <div class="form-title">
                                        <h3>手机扫码登录</h3>
                                        <span>没账号(&gt;^ω^&lt;)？</span>
                                        <a class="j-dialog-login-mode" data-contentid="register">快速注册></a>
                                    </div>
                                    <div class="tip-pics">
                                        <div class="tip-qrcode">
                                            <div class="j-dialog-qrcode"></div>
                                            <div class="j-refresh-qrcode refresh-qrcode hide">
                                                <div class="refresh-text">二维码失效</div>
                                                <div class="refresh-btn">刷新二维码</div>
                                            </div>
                                        </div>
                                        <div class="tip-help">
                                            <img src="//static.mkzcdn.com/home/assets/images/login/pic_login_sysimg.png?v=6003eb7"
                                                 alt="扫一扫" />
                                        </div>
                                    </div>
                                    <div class="tip-text">
                                        打开APP> 我的> 右上方”扫一扫”
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 第三方登录 -->
                        @*<div class="j-dialog-other-login other-login">
                            <h3 class="j-dialog-other-title title">
                                <div class="title-line"></div>
                                <div class="title-text">其他登录方式</div>
                            </h3>
                            <div class="other-link">
                                <a href="/login/oauth/?oauth_id=101" rel="nofollow" class="other-login-qq">
                                    <i class="iconfont icon-ic_buytoast_qq"></i>
                                </a>
                                <a href="/login/oauth/?oauth_id=201" rel="nofollow" class="other-login-wx">
                                    <i class="iconfont icon-ic_login_wx"></i>
                                </a>
                                <a href="/login/oauth/?oauth_id=301" rel="nofollow" class="other-login-sina">
                                    <i class="iconfont icon-ic_login_xl"></i>
                                </a>
                                <!-- 扫码登录 -->
                                <div class="j-dialog-switch-mode other-link__qr" data-contentid="qr">
                                    <i class="iconfont icon-ic_login_smdl"></i>
                                    <span class="other-link__qr--text">扫码登录</span>
                                </div>
                                <!-- 账号登录 -->
                                <div class="j-dialog-switch-mode other-link__qr hide" data-contentid="login">
                                    <i class="iconfont icon-ic_login_zhdl"></i>
                                    <span class="other-link__qr--text">账号登录</span>
                                </div>
                            </div>
                        </div>*@
                    </div>
                </div>

            </div>
        </div>
    </div>


    <div class="in-header">
        <div class="in-header__wrap container--response">
            <a class="in-header__logo" href="/"></a>
            <div class="in-header__nav">
                <ul class="clearfix">
                    <li class="nav-item active">
                        <a href="/">TRANG CHỦ</a>
                        <div class="underline"></div>
                    </li>
                    <!-- <li class="nav-item ">
                      <a href="/update/">MỚI CẬP NHẬT</a>
                      <div class="underline"></div>
                    </li> -->
                    <li class="nav-item ">
                        <a href="/top/">XẾP HẠNG</a>
                        <div class="underline"></div>
                    </li>
                    <li class="nav-item ">
                        <a href="/category/">PHÂN LOẠI</a>
                        <div class="underline"></div>
                    </li>
                    <!-- <li class="nav-item hide ">
                      <a href="/category/?is_vip=1">VIP</a>
                      <div class="underline"></div>
                    </li>
                    <li class="nav-item ">
                      <a href="/free/limit/">限免</a>
                      <div class="underline"></div>
                    </li>
                    <li class="nav-item ">
                      <a href="https://www.xiaoshuohui.com.cn/">小说</a>
                      <div class="underline"></div>
                      <img class="new" src="//static.mkzcdn.com/home/assets/images/header/ic_nav_newxs.png?v=658642e" alt="new">
                    </li> -->
                </ul>
            </div>
        </div>
    </div>



    <div class="footer-wrapper">
        <!-- footer-top -->
        <div class="container--response">
            <div class="footer-top clearfix">
                <div class="column-left column-33">
                    <div class="column-box-center">
                        <a href="https://www.mkzhan.com/author/" class="pic-tg" rel="nofollow">
                            <img src="//static.mkzcdn.com/home/assets/images/footer/footer_tg.png?v=15232b4" alt="">
                        </a>
                        <div class="fl">
                            <p class="column-title"> 投稿邮箱：<a href="mailto:tougao@xiaomingtaiji.com">tougao@xiaomingtaiji.com</a></p>
                            <ul class="link-list">
                                <li>
                                    <a href="https://www.mkzhan.com/help/10013.html" target="_blank" rel="nofollow">作品要求</a>
                                </li>
                                <li>
                                    <a href="https://www.mkzhan.com/help/10016.html" target="_blank" rel="nofollow">漫画签约</a>
                                </li>
                                <li>
                                    <a href="https://www.mkzhan.com/help/10015.html" target="_blank" rel="nofollow">审核机制</a>
                                </li>
                                <li>
                                    <a href="https://www.mkzhan.com/help/10017.html" target="_blank" rel="nofollow">福利体系</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="column-center column-33">
                    <div class="column-box-center">
                        <p class="column-title">关注我们：</p>
                        <div class="fl">
                            <a class="icon-wx" href="javascript:;" rel="nofollow">
                                <div class="wx-qrcode"></div>
                            </a>
                            <a class="icon-wb" target="_blank" href="http://weibo.com/mankezhan" rel="nofollow">
                                <div class="wb-qrcode"></div>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="column-right column-33">
                    <div class="column-box-center">
                        <div class="fl online-link">
                            <p class="column-title">在线客服：</p>
                            <a class="pic-kf" href="tencent://message/?uin=204528691&amp;Site=www.mkzhan.com&amp;Menu=yes"
                               target="_blank" rel="nofollow">
                                <img src="//static.mkzcdn.com/home/assets/images/footer/footer_kf.png?v=e418bcb" alt="">
                            </a>
                        </div>
                        <div class="fl">
                            <p class="column-title qq-text">QQ群：</p>
                            <a target="_blank"
                               href="//shang.qq.com/wpa/qunwpa?idkey=a34447c7f6028298534b61c9295d12b1a273156b9674475e48ee15697f61c6d4"
                               class="pic-qq" rel="nofollow">
                                <img src="//static.mkzcdn.com/home/assets/images/footer/footer_qq.png?v=626a9ca" alt="">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- footer-bottom -->
        <div class="container--response">
            <div class="footer-bottom">
                <ul class="footer-link clearfix">
                    <li>
                        <a href="https://www.mkzhan.com/help/10001.html" target="_blank" rel="nofollow">帮助中心</a>
                    </li>
                    <li>
                        <a href="https://www.mkzhan.com/about/" target="_blank" rel="nofollow">关于我们</a>
                    </li>
                    <li>
                        <a href="https://www.mkzhan.com/contact/" target="_blank" rel="nofollow">联系我们</a>
                    </li>
                    <li>
                        <a href="https://www.mkzhan.com/map/" target="_blank" rel="nofollow">网站地图</a>
                    </li>
                    <li>
                        <a href="https://www.mkzhan.com/legal_notice/" target="_blank" rel="nofollow">法律声明</a>
                    </li>
                    <li>
                        <a href="https://www.xiaomingtaiji.com/about/auditing.html" target="_blank" rel="nofollow">内容审核</a>
                    </li>
                    <li>
                        <a href="http://shareact.50manhua.com/2021/netaccuse/report" target="_blank" rel="nofollow">网安警务室</a>
                    </li>
                    <li class="noborder">
                        <a style="cursor:pointer;" id="feedback" class="feedback j-home-feed" rel="nofollow">意见反馈</a>
                    </li>
                </ul>
                <div style="margin-top:10px;">
                    <ul class="footer-link clearfix">
                        <li>
                            <a href="https://jbts.mct.gov.cn/" target="_blank" rel="nofollow">12318全国文化市场举报</a>
                        </li>
                        <li>
                            <a href="https://www.12377.cn/" target="_blank" rel="nofollow">网上有害信息举报</a>
                        </li>
                        <li>
                            <a href="http://www.shdf.gov.cn/shdf/channels/740.html" target="_blank" rel="nofollow">扫黄打非举报</a>
                        </li>
                        <li>
                            <a href="https://www.12377.cn/jbxzxq/zpljbxzxq.html?spm=zm1033-001.0.0.1.SOXBdI" target="_blank"
                               rel="nofollow">电信诈骗举报</a>
                        </li>
                        <li>
                            <a href="https://www.12377.cn/jbxzxq/64d38691937611ebb858c9da04cf59d3_web.html?spm=zm1033-001.0.0.1.SOXBdI&amp;smallHarmType=64d38691937611ebb858c9da04cf59d3"
                               target="_blank" rel="nofollow">历史虚无主义举报</a>
                        </li>
                    </ul>
                </div>
                <p>
                    <span>联系电话：027-59327268</span>
                    <span>
                        联系QQ：<a href="tencent://message/?uin=204528691&amp;Site=www.mkzhan.com&amp;Menu=yes" target="_blank"
                                rel="nofollow">204528691</a>
                    </span>
                    <span>举报邮箱：<a href="mailto:jubao@xiaomingtaiji.com">jubao@xiaomingtaiji.com</a></span>
                    <span>工作时间：周一至周五9：00--18：00</span>
                    联系地址：湖北省武汉市洪山区新世界铭丰大厦9层
                </p>
                <p>
                    <span><a href="https://beian.miit.gov.cn/" target="_blank" rel="nofollow">鄂ICP备16020642号-7</a></span>
                    <span>鄂公网安备 42070302000053号</span>
                    网络文化经营许可证：<a href="https://static.mkzcdn.com/home/assets/images/xukezheng.jpg" target="_blank"
                                 rel="nofollow">鄂网文（2019）5588-345号</a>
                </p>
                <p>
                    <span>Copyright ©2010-2023<a href="https://www.mkzhan.com/" rel="nofollow">漫客栈</a></span>
                    <span><a href="http://www.xiaomingtaiji.com/" target="_blank" rel="nofollow">小明太极（湖北）国漫文化有限公司</a></span>
                    版权所有<a href="https://v.yunaq.com/certificate?domain=www.mkzhan.com" rel="nofollow" target="_blank">
                        <img class="pic-copyright"
                             src="//static.mkzcdn.com/home/assets/images/footer/footer_copyright.png?v=2f3e4cb">
                    </a>
                </p>
            </div>
        </div>
    </div>


</body>

</html>

<script src="js/login.js"></script>

@code {
    private LoginViewModel loginViewModel { get; set; } = new LoginViewModel();
    private bool isLogin = true;
    private bool isLogging { get; set; } = false;
    private void ToggleIsLogin()
    {
        isLogin = !isLogin;
    }
    private async Task LoginAction(LoginViewModel loginViewModel)
    {
        isLogging = true;
        var isValid = await _js.InvokeAsync<bool>("validateForm");
        if (isValid)
        {
            var token = await _accoutantsService.Login(loginViewModel);

            // Gọi hàm JavaScript để ghi token vào sessionStorage
            await _js.InvokeVoidAsync("setSessionStorage", "token", token);
            isLogging = false;
            await _js.InvokeVoidAsync("showToast", "Thành công");
            _navigationManager.NavigateTo($"/");
        }
        else
        {
            isLogging = false;
        }
    }
}
